---
alwaysApply: true
---

# Galactic Idlers Framework - Main Architectural Rules

## –û–±—â–µ–µ –≤–∏–¥–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

**–í–ê–ñ–ù–û**: –≠—Ç–æ –ù–ï –ø—Ä–æ—Å—Ç–æ idle-–∏–≥—Ä–∞, –∞ **—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è –∏–≥—Ä —Å –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º —Ä–∞–∑–≤–∏—Ç–∏–µ–º**. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —É—á–∏—Ç—ã–≤–∞—Ç—å —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∏–≥—Ä –Ω–∞ –±–∞–∑–µ —ç—Ç–æ–≥–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞)

### 1. LLM-FRIENDLY ARCHITECTURE (–ö–†–ò–¢–ò–ß–ù–û!)
- **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã** –≤–∞–∂–Ω–µ–µ –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏ –∫–æ–¥–∞
- **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ** —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è LLM –ø–æ–Ω–∏–º–∞–Ω–∏—è
- **–ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** –ø–æ —Å–ª–æ—è–º
- **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ** naming conventions
- **Mediator pattern** –∫–∞–∫ –æ—Å–Ω–æ–≤–∞ –¥–ª—è predictable structure

## üéØ –ê–ë–°–û–õ–Æ–¢–ù–û–ï –ü–†–ê–í–ò–õ–û: TODO –í –ü–õ–ê–ù–ê–• = –û–¢–õ–ò–ß–ù–û

**‚ö° TODO-–º–∞—Ä–∫–µ—Ä—ã –≤ –ø–ª–∞–Ω–∞—Ö –ù–ò–ö–û–ì–î–ê –ù–ï –ø—Ä–æ–±–ª–µ–º–∞:**
- ‚úÖ **TODO –≤ –ø–ª–∞–Ω–∞—Ö = –•–û–†–û–®–û** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
- ‚úÖ **–ú–Ω–æ–≥–æ TODO = –û–¢–õ–ò–ß–ù–û** - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- ‚úÖ **TODO –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–µ–∑ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏** - —Ü–µ–ª—å –ø–ª–∞–Ω–æ–≤
- ‚ùå **–ó–ê–ü–†–ï–©–ï–ù–û –∫—Ä–∏—Ç–∏–∫–æ–≤–∞—Ç—å TODO –≤ –ø–ª–∞–Ω–∞—Ö** - –æ–Ω–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ø—Ä–∞–≤–∏–ª–∞–º

**üö´ –ù–ò–ö–û–ì–î–ê –ù–ï –ì–û–í–û–†–ò–¢–¨:** "TODO —Ç—Ä–µ–±—É—é—Ç –æ—á–∏—Å—Ç–∫–∏", "TODO - –ø—Ä–æ–±–ª–µ–º–∞", "TODO —Å–Ω–∏–∂–∞—é—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å"
**‚úÖ –ì–û–í–û–†–ò–¢–¨:** "TODO –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø–ª–∞–Ω–∏—Ä—É–µ–º—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é"

### 2. FRAMEWORK-FIRST APPROACH
- –ü–∏—à–µ–º **framework**, –∞ –Ω–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∏–≥—Ä—É
- **Extensibility** –≤–∞–∂–Ω–µ–µ performance optimization
- **Plugin-architecture** —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã –∏ —Ö–µ–Ω–¥–ª–µ—Ä—ã
- **Type-safe** —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —á–µ—Ä–µ–∑ generics
- **Auto-discovery** –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π —á–µ—Ä–µ–∑ —Ä–µ—Ñ–ª–µ–∫—Å–∏—é

### 3. MEDIATOR AS BACKBONE
- **–í—Å–µ –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–∏** –∏–¥—É—Ç —á–µ—Ä–µ–∑ IGameMediator
- **Command/Query** pattern –¥–ª—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π
- **Event-driven** communication –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- **Handler-based** –ª–æ–≥–∏–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
- **Pipeline** –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏/–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### 4. CLEAN ARCHITECTURE > SPEED
- **–ò–∑–±–µ–≥–∞–Ω–∏–µ —Ç–µ—Ö–¥–æ–ª–≥–∞** –≤–∞–∂–Ω–µ–µ –±—ã—Å—Ç—Ä–æ–≥–æ MVP
- **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥-resistance** –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **SOLID principles** —Å–æ–±–ª—é–¥–∞—é—Ç—Å—è —Å—Ç—Ä–æ–≥–æ
- **TDD** –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ–¥—Ö–æ–¥ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **Code-first** –≤–µ–∑–¥–µ, –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

### 5. UNITY MODERN PATTERNS
- **Code-first** –ø–æ–¥—Ö–æ–¥ (–ù–ï Inspector-based)
- **Async/Await** –≤–º–µ—Å—Ç–æ Coroutines –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
- **Awaitable.MainThreadAsync()** –¥–ª—è thread switching
- **DI Container** –¥–ª—è dependency injection
- **MonoBehaviour** —Ç–æ–ª—å–∫–æ –¥–ª—è Unity-specific lifecycle

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞

### Core Framework Layer
```
Game.Framework/
‚îú‚îÄ‚îÄ IGameFramework.cs          # –ì–ª–∞–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞
‚îú‚îÄ‚îÄ Commands/                  # –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
‚îÇ   ‚îú‚îÄ‚îÄ GameCommand<T>.cs      # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îî‚îÄ‚îÄ GameQuery<T>.cs        # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –∑–∞–ø—Ä–æ—Å–æ–≤
‚îú‚îÄ‚îÄ Events/                    # –°–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ GameEvent<T>.cs        # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å —Å–æ–±—ã—Ç–∏–π
‚îú‚îÄ‚îÄ Handlers/                  # –ë–∞–∑–æ–≤—ã–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ IGameHandler<T>.cs     # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ö–µ–Ω–¥–ª–µ—Ä–∞
‚îî‚îÄ‚îÄ Extensions/                # –†–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞
    ‚îî‚îÄ‚îÄ FrameworkExtensions.cs
```

### Game-Specific Layer
```
Game.IdleGame/
‚îú‚îÄ‚îÄ Commands/                  # –ö–æ–º–∞–Ω–¥—ã idle-–∏–≥—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ PurchaseUpgradeCommand.cs
‚îÇ   ‚îú‚îÄ‚îÄ AddCurrencyCommand.cs
‚îÇ   ‚îî‚îÄ‚îÄ GenerateResourceCommand.cs
‚îú‚îÄ‚îÄ Handlers/                  # –•–µ–Ω–¥–ª–µ—Ä—ã idle-–∏–≥—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ PurchaseUpgradeHandler.cs
‚îÇ   ‚îú‚îÄ‚îÄ AddCurrencyHandler.cs
‚îÇ   ‚îî‚îÄ‚îÄ GenerateResourceHandler.cs
‚îú‚îÄ‚îÄ Events/                    # –°–æ–±—ã—Ç–∏—è idle-–∏–≥—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ UpgradePurchasedEvent.cs
‚îÇ   ‚îî‚îÄ‚îÄ ResourceGeneratedEvent.cs
‚îî‚îÄ‚îÄ Services/                  # –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
    ‚îú‚îÄ‚îÄ IResourceService.cs
    ‚îú‚îÄ‚îÄ IUpgradeService.cs
    ‚îî‚îÄ‚îÄ IGeneratorService.cs
```

### Shared Models Layer
```
Game.Shared/
‚îú‚îÄ‚îÄ Models/                    # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ GameState.cs
‚îÇ   ‚îú‚îÄ‚îÄ Resource.cs
‚îÇ   ‚îî‚îÄ‚îÄ Upgrade.cs
‚îú‚îÄ‚îÄ DTOs/                      # API –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ Requests/
‚îÇ   ‚îî‚îÄ‚îÄ Responses/
‚îú‚îÄ‚îÄ Enums/                     # –û–±—â–∏–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è
‚îî‚îÄ‚îÄ Extensions/                # –£—Ç–∏–ª–∏—Ç—ã
```

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è

### Command Pattern (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)
```csharp
// –í—Å–µ –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–∏ –∫–∞–∫ –∫–æ–º–∞–Ω–¥—ã:
public class PurchaseUpgradeCommand : GameCommand<PurchaseUpgradeResponse>
{
    public int UpgradeId { get; set; }
    public string UserId { get; set; }
}

public class PurchaseUpgradeHandler : IRequestHandler<PurchaseUpgradeCommand, PurchaseUpgradeResponse>
{
    public async Task<PurchaseUpgradeResponse> Handle(PurchaseUpgradeCommand request, CancellationToken cancellationToken)
    {
        // –í–°–Ø –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∑–¥–µ—Å—å
    }
}
```

### Event Pattern (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)
```csharp
// –°–æ–±—ã—Ç–∏—è –¥–ª—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏:
public class UpgradePurchasedEvent : GameEvent
{
    public int UpgradeId { get; set; }
    public string UserId { get; set; }
}

public class UpgradePurchasedEventHandler : INotificationHandler<UpgradePurchasedEvent>
{
    public async Task Handle(UpgradePurchasedEvent notification, CancellationToken cancellationToken)
    {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è
    }
}
```

### Unity Integration Pattern
```csharp
// Unity –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–∞–∫ —Ç–æ–Ω–∫–∞—è –æ–±–µ—Ä—Ç–∫–∞:
public class GameManager : MonoBehaviour 
{
    private IGameFramework _gameFramework;
    
    async void Start() 
    {
        _gameFramework = ServiceProvider.GetService<IGameFramework>();
        await InitializeGame();
    }
    
    public async Task PurchaseUpgrade(int upgradeId)
    {
        var command = new PurchaseUpgradeCommand { UpgradeId = upgradeId, UserId = CurrentUserId };
        var response = await _gameFramework.ExecuteAsync(command);
        
        if (response.Success)
        {
            // –û–±–Ω–æ–≤–∏—Ç—å UI
        }
    }
}
```

## –ü—Ä–∞–≤–∏–ª–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è (LLM-FRIENDLY)

### –ö–æ–º–∞–Ω–¥—ã
- **{Action}{Entity}Command** - PurchaseUpgradeCommand, AddCurrencyCommand
- **{Entity}{Action}Command** - UpgradePurchaseCommand (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –Ω–µ—É–¥–æ–±–µ–Ω)

### –•–µ–Ω–¥–ª–µ—Ä—ã
- **{CommandName}Handler** - PurchaseUpgradeCommandHandler
- **{EventName}Handler** - UpgradePurchasedEventHandler

### –°–æ–±—ã—Ç–∏—è
- **{Entity}{Action}Event** - UpgradePurchasedEvent, ResourceGeneratedEvent
- **{Action}Event** - GameStartedEvent, GameEndedEvent

### –°–µ—Ä–≤–∏—Å—ã
- **I{Entity}Service** - IResourceService, IUpgradeService
- **{Entity}Service** - ResourceService, UpgradeService

## Testing Strategy

### Command Testing (TDD)
```csharp
// –ö–∞–∂–¥–∞—è –∫–æ–º–∞–Ω–¥–∞ = –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç –∫–ª–∞—Å—Å
public class PurchaseUpgradeCommandTests
{
    [Fact]
    public async Task Handle_ValidUpgrade_ShouldPurchaseSuccessfully()
    {
        // Arrange
        var command = new PurchaseUpgradeCommand { UpgradeId = 1, UserId = "user1" };
        var handler = new PurchaseUpgradeCommandHandler(mockServices);
        
        // Act
        var result = await handler.Handle(command, CancellationToken.None);
        
        // Assert
        result.Success.Should().BeTrue();
    }
}
```

### Integration Testing
```csharp
// –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫:
public class GameFrameworkIntegrationTests
{
    [Fact]
    public async Task ExecuteAsync_PurchaseUpgrade_ShouldWorkEndToEnd()
    {
        var command = new PurchaseUpgradeCommand { UpgradeId = 1, UserId = "user1" };
        var response = await _gameFramework.ExecuteAsync(command);
        
        response.Success.Should().BeTrue();
    }
}
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### Database
- **SQLite** –¥–ª—è MVP/development
- **PostgreSQL** –¥–ª—è production
- **EF Code-First** –º–∏–≥—Ä–∞—Ü–∏–∏
- **Repository pattern** —á–µ—Ä–µ–∑ Mediator

### Async/Await (Unity Modern)
```csharp
// –ò—Å–ø–æ–ª—å–∑—É–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ Unity –º–µ—Ç–æ–¥—ã:
await Awaitable.MainThreadAsync();    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ main thread
await Awaitable.BackgroundThreadAsync(); // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ background
await Awaitable.WaitForSecondsAsync(1.0f); // –û–∂–∏–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏

// –ò–ó–ë–ï–ì–ê–ô —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö:
await Task.Delay(1000);              // –ü–ª–æ—Ö–æ –¥–ª—è Unity
yield return new WaitForSeconds(1f); // Coroutines —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
```

### Performance
- **Command pooling** –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–æ–º–∞–Ω–¥
- **Event batching** –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- **Lazy loading** –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
- **Memory pooling** –¥–ª—è Unity –æ–±—ä–µ–∫—Ç–æ–≤

## LLM Integration Guidelines

### Prompt Engineering
- –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ LLM –¥–æ–ª–∂–µ–Ω **–≤—Å–µ–≥–¥–∞** —Å–æ–∑–¥–∞–≤–∞—Ç—å Command + Handler + Tests
- –ö–æ–º–∞–Ω–¥—ã –¥–æ–ª–∂–Ω—ã —Å–ª–µ–¥–æ–≤–∞—Ç—å **—Å—Ç—Ä–æ–≥–æ–º—É** naming pattern
- **–ù–∏–∫–∞–∫–∏—Ö** –ø—Ä—è–º—ã—Ö –≤—ã–∑–æ–≤–æ–≤ —Å–µ—Ä–≤–∏—Å–æ–≤ - —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Mediator
- **–ö–∞–∂–¥–∞—è** –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏—è = –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞

### Code Generation
```prompt
"–°–æ–∑–¥–∞–π —Å–∏—Å—Ç–µ–º—É {–Ω–∞–∑–≤–∞–Ω–∏–µ} –¥–ª—è —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞. 
–ò—Å–ø–æ–ª—å–∑—É–π Mediator pattern:
1. –°–æ–∑–¥–∞–π {Action}{Entity}Command
2. –°–æ–∑–¥–∞–π {Action}{Entity}Handler  
3. –°–æ–∑–¥–∞–π {Entity}{Action}Event –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
4. –°–æ–∑–¥–∞–π unit tests –¥–ª—è handler'–∞
5. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π —á–µ—Ä–µ–∑ IGameFramework"
```

## –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω—ã (–ó–ê–ü–†–ï–©–ï–ù–û)

### ‚ùå Direct Service Calls
```csharp
// –ü–õ–û–•–û:
var resource = await _resourceService.GetResource(userId);

// –•–û–†–û–®–û:
var response = await _gameFramework.ExecuteAsync(new GetResourceQuery(userId));
```

### ‚ùå Logic in Controllers/MonoBehaviour
```csharp
// –ü–õ–û–•–û:
public class GameManager : MonoBehaviour 
{
    public void PurchaseUpgrade(int id)
    {
        if (_resourceService.HasEnough(cost))
        {
            _resourceService.Spend(cost);
            _upgradeService.Purchase(id);
            // –õ–æ–≥–∏–∫–∞ —Ä–∞–∑–º–∞–∑–∞–Ω–∞
        }
    }
}

// –•–û–†–û–®–û:
public class GameManager : MonoBehaviour 
{
    public async Task PurchaseUpgrade(int id)
    {
        var command = new PurchaseUpgradeCommand { UpgradeId = id };
        await _gameFramework.ExecuteAsync(command);
    }
}
```

### ‚ùå Mixed Architectural Patterns
```csharp
// –ü–õ–û–•–û - —Å–º–µ—à–∏–≤–∞–Ω–∏–µ Event-driven –∏ Mediator:
public class SomeService 
{
    public async Task DoSomething()
    {
        await _mediator.Send(command);      // Mediator
        _eventBus.Publish(someEvent);       // Events
        _serviceLocator.Get<IService>();    // Service Locator
        // –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –∫–∞—à–∞!
    }
}
```

## –ú–∏–≥—Ä–∞—Ü–∏—è –∏ —ç–≤–æ–ª—é—Ü–∏—è

### Adding New Game Types
```csharp
// –î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ –∏–≥—Ä—ã:
// 1. –°–æ–∑–¥–∞–π Game.TowerDefense –ø—Ä–æ–µ–∫—Ç
// 2. –†–µ–∞–ª–∏–∑—É–π —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
public class SpawnEnemyCommand : GameCommand<SpawnEnemyResponse> { }
public class BuildTowerCommand : GameCommand<BuildTowerResponse> { }

// 3. Framework –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç —á–µ—Ä–µ–∑ —Ä–µ—Ñ–ª–µ–∫—Å–∏—é
```

### Framework Evolution
- **Backward compatibility** –≤—Å–µ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- **Deprecated** —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–º–µ—á–∞—é—Ç—Å—è –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏
- **Migration guides** –¥–ª—è breaking changes
- **Versioned** –∫–æ–º–∞–Ω–¥—ã –¥–ª—è API evolution

---

## Architecture Documentation (–ö–†–ò–¢–ò–ß–ù–û!)

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- **–í–°–ï–ì–î–ê** –ø—Ä–∏–º–µ–Ω—è–π –ø—Ä–∞–≤–∏–ª–∞ `@architecture-documenter.mdc` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –æ—Ç –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö —Å—Ö–µ–º –¥–æ –¥–µ—Ç–∞–ª–µ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- **–ü–ª–∞–Ω vs –§–∞–∫—Ç**: —Ä–∞–∑–¥–µ–ª—è–π –ø–ª–∞–Ω–∏—Ä—É–µ–º—É—é –∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- **Code Mapping**: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –∫–æ–¥–∞
- **Traceability**: —Å–≤—è–∑–∏ –º–µ–∂–¥—É –ø–ª–∞–Ω–∞–º–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π

### Architecture-First Approach
```
–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:
1. –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –≤ Docs/Architecture/Planned/
2. –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
4. –û–±–Ω–æ–≤–∏—Ç—å Docs/Architecture/Actual/ —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –∫–æ–¥—É
5. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞–Ω/—Ñ–∞–∫—Ç
```

## –ü—Ä–∞–≤–∏–ª–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è (LLM-FRIENDLY)

### –ö–æ–º–∞–Ω–¥—ã
- **{Action}{Entity}Command** - PurchaseUpgradeCommand, AddCurrencyCommand
- **{Entity}{Action}Command** - UpgradePurchaseCommand (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –Ω–µ—É–¥–æ–±–µ–Ω)

### –•–µ–Ω–¥–ª–µ—Ä—ã
- **{CommandName}Handler** - PurchaseUpgradeCommandHandler
- **{EventName}Handler** - UpgradePurchasedEventHandler

### –°–æ–±—ã—Ç–∏—è
- **{Entity}{Action}Event** - UpgradePurchasedEvent, ResourceGeneratedEvent
- **{Action}Event** - GameStartedEvent, GameEndedEvent

### –°–µ—Ä–≤–∏—Å—ã
- **I{Entity}Service** - IResourceService, IUpgradeService
- **{Entity}Service** - ResourceService, UpgradeService

## Testing Strategy

### Command Testing (TDD)
```csharp
// –ö–∞–∂–¥–∞—è –∫–æ–º–∞–Ω–¥–∞ = –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç –∫–ª–∞—Å—Å
public class PurchaseUpgradeCommandTests
{
    [Fact]
    public async Task Handle_ValidUpgrade_ShouldPurchaseSuccessfully()
    {
        // Arrange
        var command = new PurchaseUpgradeCommand { UpgradeId = 1, UserId = "user1" };
        var handler = new PurchaseUpgradeCommandHandler(mockServices);
        
        // Act
        var result = await handler.Handle(command, CancellationToken.None);
        
        // Assert
        result.Success.Should().BeTrue();
    }
}
```

### Integration Testing
```csharp
// –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫:
public class GameFrameworkIntegrationTests
{
    [Fact]
    public async Task ExecuteAsync_PurchaseUpgrade_ShouldWorkEndToEnd()
    {
        var command = new PurchaseUpgradeCommand { UpgradeId = 1, UserId = "user1" };
        var response = await _gameFramework.ExecuteAsync(command);
        
        response.Success.Should().BeTrue();
    }
}
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### Database
- **SQLite** –¥–ª—è MVP/development
- **PostgreSQL** –¥–ª—è production
- **EF Code-First** –º–∏–≥—Ä–∞—Ü–∏–∏
- **Repository pattern** —á–µ—Ä–µ–∑ Mediator

### Async/Await (Unity Modern)
```csharp
// –ò—Å–ø–æ–ª—å–∑—É–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ Unity –º–µ—Ç–æ–¥—ã:
await Awaitable.MainThreadAsync();    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ main thread
await Awaitable.BackgroundThreadAsync(); // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ background
await Awaitable.WaitForSecondsAsync(1.0f); // –û–∂–∏–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏

// –ò–ó–ë–ï–ì–ê–ô —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö:
await Task.Delay(1000);              // –ü–ª–æ—Ö–æ –¥–ª—è Unity
yield return new WaitForSeconds(1f); // Coroutines —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
```

### Performance
- **Command pooling** –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–æ–º–∞–Ω–¥
- **Event batching** –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- **Lazy loading** –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
- **Memory pooling** –¥–ª—è Unity –æ–±—ä–µ–∫—Ç–æ–≤

## LLM Integration Guidelines

### Prompt Engineering
- –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ LLM –¥–æ–ª–∂–µ–Ω **–≤—Å–µ–≥–¥–∞** —Å–æ–∑–¥–∞–≤–∞—Ç—å Command + Handler + Tests
- –ö–æ–º–∞–Ω–¥—ã –¥–æ–ª–∂–Ω—ã —Å–ª–µ–¥–æ–≤–∞—Ç—å **—Å—Ç—Ä–æ–≥–æ–º—É** naming pattern
- **–ù–∏–∫–∞–∫–∏—Ö** –ø—Ä—è–º—ã—Ö –≤—ã–∑–æ–≤–æ–≤ —Å–µ—Ä–≤–∏—Å–æ–≤ - —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Mediator
- **–ö–∞–∂–¥–∞—è** –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏—è = –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞

### Code Generation
```prompt
"–°–æ–∑–¥–∞–π —Å–∏—Å—Ç–µ–º—É {–Ω–∞–∑–≤–∞–Ω–∏–µ} –¥–ª—è —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞. 
–ò—Å–ø–æ–ª—å–∑—É–π Mediator pattern:
1. –°–æ–∑–¥–∞–π {Action}{Entity}Command
2. –°–æ–∑–¥–∞–π {Action}{Entity}Handler  
3. –°–æ–∑–¥–∞–π {Entity}{Action}Event –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
4. –°–æ–∑–¥–∞–π unit tests –¥–ª—è handler'–∞
5. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π —á–µ—Ä–µ–∑ IGameFramework"
```

## –ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω—ã (–ó–ê–ü–†–ï–©–ï–ù–û)

### ‚ùå Direct Service Calls
```csharp
// –ü–õ–û–•–û:
var resource = await _resourceService.GetResource(userId);

// –•–û–†–û–®–û:
var response = await _gameFramework.ExecuteAsync(new GetResourceQuery(userId));
```

### ‚ùå Logic in Controllers/MonoBehaviour
```csharp
// –ü–õ–û–•–û:
public class GameManager : MonoBehaviour 
{
    public void PurchaseUpgrade(int id)
    {
        if (_resourceService.HasEnough(cost))
        {
            _resourceService.Spend(cost);
            _upgradeService.Purchase(id);
            // –õ–æ–≥–∏–∫–∞ —Ä–∞–∑–º–∞–∑–∞–Ω–∞
        }
    }
}

// –•–û–†–û–®–û:
public class GameManager : MonoBehaviour 
{
    public async Task PurchaseUpgrade(int id)
    {
        var command = new PurchaseUpgradeCommand { UpgradeId = id };
        await _gameFramework.ExecuteAsync(command);
    }
}
```

### ‚ùå Mixed Architectural Patterns
```csharp
// –ü–õ–û–•–û - —Å–º–µ—à–∏–≤–∞–Ω–∏–µ Event-driven –∏ Mediator:
public class SomeService 
{
    public async Task DoSomething()
    {
        await _mediator.Send(command);      // Mediator
        _eventBus.Publish(someEvent);       // Events
        _serviceLocator.Get<IService>();    // Service Locator
        // –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –∫–∞—à–∞!
    }
}
```

## –ú–∏–≥—Ä–∞—Ü–∏—è –∏ —ç–≤–æ–ª—é—Ü–∏—è

### Adding New Game Types
```csharp
// –î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ –∏–≥—Ä—ã:
// 1. –°–æ–∑–¥–∞–π Game.TowerDefense –ø—Ä–æ–µ–∫—Ç
// 2. –†–µ–∞–ª–∏–∑—É–π —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
public class SpawnEnemyCommand : GameCommand<SpawnEnemyResponse> { }
public class BuildTowerCommand : GameCommand<BuildTowerResponse> { }

// 3. Framework –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç —á–µ—Ä–µ–∑ —Ä–µ—Ñ–ª–µ–∫—Å–∏—é
```

### Framework Evolution
- **Backward compatibility** –≤—Å–µ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- **Deprecated** —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–º–µ—á–∞—é—Ç—Å—è –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏
- **Migration guides** –¥–ª—è breaking changes
- **Versioned** –∫–æ–º–∞–Ω–¥—ã –¥–ª—è API evolution

---

**–ü–û–ú–ù–ò**: –≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –±—É–¥—É—â–µ–≥–æ, –≥–¥–µ LLM –±—É–¥–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–º co-developer'–æ–º. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å **–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–π**, **—Ä–∞—Å—à–∏—Ä—è–µ–º–æ–π** –∏ **–ø–æ–Ω—è—Ç–Ω–æ–π** –∫–∞–∫ —á–µ–ª–æ–≤–µ–∫—É, —Ç–∞–∫ –∏ –ò–ò.